# CDN

### 배경
* 현대에 들어서면서 동영상 스트리밍이나 온라인 게임, 대용량 파일 전송, 고해상도 이미지 등의 대용량 컨텐츠 서비스 업체들이 증가
* 대용량 컨텐츠를 중앙 서버에서 사용자에게 전송시, 거리에 의한 지연으로 로딩시간이 길어져 사용성이 떨어지고 네트워크 혼잡 문제 발생

```
사용자게 이미지를 제공하는 서비스라고 가정한다.
처음 서비스 시작시 특정 지역, 예를들어 한국에서 해당 서비스를 호스팅했다고 가정한다. 처음엔 한국에 있는 사용자만 주로 서비스를 이용했다.
그러나 서비스의 인기가 높아짐에 따라 한국외에 해외에서 더 많은 사용자들이 서비스를 이용하기 시작했다. 그러자 세 가지 문제가 발생했는데,
첫째, 같은 웹서버에 접속하는 사용자 수가 늘어나 웹서버 부하가 증가하면 서버가 모든 사용자를 동시에 지원할 수 없게 되어 웹사이트에 접속하는 사용자 경험이 악화
둘째, 원본 서버가 한국에 있기 때문에 데이터는 지리적으로 먼 위치에서 전송되므로 서버에 접속하는 사용자에게 지연이 발생
셋째, 더 많은 사용자에게 콘텐츠를 제공하기 위해 더 많은 대역폭이 필요해짐에 따라 원본 서버에서 콘텐츠를 제공하기 위해 지불해야 하는 대역폭 비용 증가
```

### 부하분산
* 대용량 컨텐츠 리소스를 항상 컨텐츠 제공업체 서버에서 전송하게되면, 서버와 인프라에 많은 부하 가중
* 컨텐츠 제공업체 서버로 갈 요청을 CDN 에서 대신 받아 응답하므로 컨텐츠 서버의 부하 분산 수행 및 가용성 증대
```
첫 번째 문제의 경우, 사용자 요청이 리소스 전송에 가장 적합한 POP으로 전송되어 처리됨. 
따라서 모든 사용자의 요청을 원본 서버로 보내는 대신 분산 노드로 보내므로 원본 서버의 부하가 감소
```

### 캐싱
* CDN은 지리적으로 분산된 여러 개의 캐시 서버로서 웹 페이지, 이미지, 비디오 등의 콘텐츠를 사용자의 물리적 위치와 가까운 CDN 서버(PoP(Points of Presence))에 캐싱
* 이후 동일한 리소스를 동일한 POP 서버로 요청시, 사용자의 물리적 위치와 가장 가까운 서버인 POP 서버에서 바로 전송함으로서, 전송속도를 높혀 지연시간 단축
```
두 번째 문제의 경우, CDN 노드가 여러 지역에 걸쳐 분산되어있어, 사용자는 가장 가까운 지역에 있는 노드(POP)에서 콘텐츠를 제공받으므로 원본 서버와의 거리로 인한 문제가 발생하지 않음
```

### 혼잡제어
* 대용량 컨텐츠를 물리적 거리가 먼 중앙서버에서 사용자에게 직접 전송시, 여러개의 라우터를 거치게 되고, 이로인해 네트워크 혼잡 문제 발생 가능 및 많은 대욕폭 비용 필요
* 중앙서버가 아닌, 사용자와 인접한 CDN 에서 전송함으로서, 더 적은 HOP 을 거치게 되므로 네트워크 리소스를 더 적게 사용하여 대욕폭 비용 절약 가능
```
세 번째 문제인 비용의 경우, CDN을 사용하면 모든 요청이 지리적으로 먼 서버로 가는것이 아닌, CDN 에서 처리하고, CDN 노드는 일반적으로 원본 서버보다 대역폭 비용이 훨씬 저렴하므로 대역폭 비용 절약 가능   
```

### 보안
* 현대의 악의적 공격자에 의한 공격은 정상 트래픽과 악성 트래픽을 구별하기가 쉽지 않은 경우가 대부분이며, 시간이 지나면서 공격 전략이 급속도로 진화
* 이같은 공격을 막기위해, 보안 시스템을 최신 상태로 유지하는데에 많은 보안 전담 리소스가 소모되므로, 대신 CDN 을 통해 보안을 강화하여 안전한 웹사이트를 지원하는 것이 CDN의 중요한 요구사항이 됨
* 따라서, 현대의 CDN 들은 유입되는 트래픽을 분석해 ‘정상 트래픽’과 ‘공격 트래픽’을 구분 짓는 게이트웨이 역할을 함으로서 보안을 강화해주는, 클라우드 보안 기반 보안서비스(SECaaS)도 함께 제공

### 처리 과정
1. 사용자가 서버 URL 로 리소스 요청
2. DNS는 가장 성능이 좋은(사용자와 지리적으로 가장 가까운) POP 위치로 요청을 라우팅 
3. POP의 에지 서버 캐시에 파일이 없으면, POP는 원본 서버에 리소스 요청
4. 원본 서버는 리소스를 POP의 에지 서버로 반환
5. POP의 에지 서버는 리소스 캐싱 및 사용자게 응답. 리소스는 HTTP TTL(Time-To-Live) 헤더로 설정한 시간이 만료될 때까지 POP의 에지 서버에 캐싱
6. 또다른 사용자가 가까운 지역에서 서버 URL 로 동일한 리소스 요청시 DNS 는 동일한 POP 으로 라우팅
7. POP 에지 서버에 캐싱되어있는 리소스의 TTL 확인후, 만료되지 않았으면 리소스 응답

### CDN이 필요한 경우
* 고화질 이미지, 동영상, 게임등의 대용량 컨텐츠를 다루면서, 여러국가나 광범위한 지역에 걸쳐 서비스를 하는 경우
* 특정 국가나 지역만을 타깃으로 서비스시, CDN 서비스 불필요. 오히려 불필요한 연결 지점이 늘어나 웹 사이트의 성능 저하 야기

### CDN 활용 사례
* 온라인 동영상 스트리밍 서비스를 제공하는 넷플릭스(Netflix)는 전 세계의 사용자들에게 안정적인 서비스를 제공하기 위해 2011년에 자체 CDN을 구축 (서비스의 범위가 전세계고, 구독자의 절반이 미국외의 지역에 분포)
* 세계 최대 숙박 공유 서비스인 에어비앤비(Airbnb) 또한 CDN 기술을 활용해 전 세계 고객에게 언제 어디서나 숙박 시설과 각종 액티비티를 예약할 수 있는 서비스 환경을 구축
* 국내에서는 NC소프트나 카카오게임즈 같은 온라인 게임 기업이 CDN을 활용, 북미나 유럽과 같이 지리적으로 먼 지역의 사용자에게 안정적이고 빠른 게임 플레이 환경을 제공

![image](https://user-images.githubusercontent.com/48702893/162711056-b0c25106-9046-4299-bc7d-8f467df9eca3.png)

***
> Reference
* https://library.gabia.com/contents/infrahosting/8985/
* https://www.akamai.com/ko/our-thinking/cdn/what-is-a-cdn
* https://www.alibabacloud.com/ko/knowledge/what-is-cdn
* http://www.cctvnews.co.kr/news/articleView.html?idxno=68007
* http://www.realmobile.net/products/product_main08_02.asp