# 캐시 생명주기
* 서버에서 내려주는 응답의 Cache-Control 헤더 값 또는 Expires 헤더값에 따라 캐시 수명 결정

### Cache-Control
* 데이터가 캐시된 날짜(Date헤더)로부터 Cache-Control: max-age 로 설정된 시간(단위 : 초)까지가 캐시의 수명
e.g) Cache-Control: max-age=484200
* 캐시 만료전, 동일한 데이터 요청시, 브라우저에서 서버로 요청을 보내지 않고, 브라우저 캐시에서 데이터 조회하여 응답
  ![image](https://user-images.githubusercontent.com/48702893/162687610-22a554cb-d9ae-43fe-93c7-63eb74e426ec.png)

#### no-store
* 어떠한 캐시(e.g. 브라우저 캐시, 프록시 캐시)에도 캐싱 금지

#### no-cache
* 캐싱 허용, 하지만 캐시 적중시 만료 여부 상관없이 매번 캐시 재검사 수행 , max-age=0 과 동일한 의미

#### must-revalidate
* 캐시 만료시 반드시 캐시 재검사 수행

#### max-stale
* 캐시가 이미 만료되었어도 만료된 시간이 max-stale 로 설정한 시간이내라면 사용
* 약한검사기

#### min-fresh
* 캐시가 아직 신선하여도, 앞으로 min-fresh 시간 안에 만료된다면 현재 만료된것으로 판단
* 강한검사기

#### public
* CDN 과 같은 중간 캐시 서버들에도 캐싱을 허용
```
Cache-Control: public, max-age=86400
```
* 중간 캐시 서버들에 캐싱시, 별도의 캐시 수명을 설정하고자 한다면 s-maxage 필드 이용
```
Cache-Control: public, s-maxage=31536000, max-age=86400
```

#### private
* CDN 과 같은 중간 캐시 서버들에 캐싱 비허용
* 브라우저에만 캐싱됨
```
Cache-Control: private, max-age=86400
```

### Expires
* 캐시 만료 절대 날짜로서 설정된 날짜, 시간에 만료
e.g) Expires: Thu, 26 Jul 2018 07:28:00 GMT
* Cache-Control 과 함께쓰일경우, Cache-Contorl 무시하고, Expires 로 캐시 수명 설정됨

<br>

# 캐시 재검사
* 캐시 적중한 데이터가 수명이 다되어 만료되었을경우, 서버로 조건부 헤더가 포함된 요청 메시지를 전송하여 캐시 재검사 수행

### 조건부 요청 메시지
* 작고 간단한 조건부 GET 메시지를 전송하여 재검사에 오랜 시간이 소모되지 않도록 함
* If-None-Match 나 If-Modified-Since 같은 조건부 헤더를 포함하여, 재검사에 필요한 정보 전달

### 조건부 헤더
* **If-Modified-Since**
   * 캐시 데이터가 마지막으로 수정(캐싱)된 시간인 Last_Modified 을 전달하는 헤더 필드
   * 웹서버 원본 데이터의 마지막 수정 날짜 값과 비교
   * 마지막 수정 날짜 값과 If-Modified-Since 값이 다를경우 원본데이터가 수정된것으로 판단
* **If-None-Match**
   * 캐시 데이터의 etag 값
   * 웹서버 원본데이터의 etag 값과 비교하여 값이 다를경우, 원본데이터가 수정된것으로 판단
   * 약한 검사기 지원
   * **Etag 를 사용하는 경우**
      1. 웹서버의 백그라운드 프로세스등에 의해 일부 리소스가 일정시간마다 재작성이 되는 경우(동일한 내용)
      2. 캐시데이터를 갱신하지 않아도 괜찮은, 사소한 내용이 수정되었을 경우
      3. 웹서버에서 최근 변경일시를 정확하게 판별하기 힘든 종류의 리소스인경우
   * **약한 검사기**
      * 캐시데이터를 갱신할 필요가 없는, 사소한 내용이 수정되었을 경우, 수정되지 않았다 판단
      * W/ 접두사를 ETag헤더필드에 붙여 강한 검사기와 구분
         ```
         ETag: W/"v2.6"
         If-None-Match: W/"v2.6"
         ```
      
### 재검사 요청메세지에 대한 웹서버 응답
* **데이터가 수정되지 않음** :  304 Not Modified 응답, 새로운 캐시 만료 날짜와 함께 갱신이 필요한 헤더값만을 전송
* **데이터가 수정됨** : 새로운 만료 날짜를 포함한 응답 헤더 + 원본데이터와 함꼐 200 OK 응답
* **데이터가 삭제됨** : 404 Not Found 응답
