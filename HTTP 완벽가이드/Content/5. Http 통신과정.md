# Http 통신과정
### 1. 커넥션 수립
* 클라이언트가 서버에게 커넥션 수립 요청 메시지 전송
* 서버는 커넥션을 맺고 클라이언트 IP를 추출하여 클라이언트 식별
* 만약 인가되지 않았거나 악의적인 클라이언트 일시 커넥션 종료
* 정상적인 클라이언트일시 커넥션 리스트에 커넥션 추가, 데이터 리스닝
* **클라이언트 식별 방식**
   1. 역방향 DNS
      * 클라이언트의 IP주로를 클라이언트 호스트명으로 변환
      * HostnameLookups 이용(웹서버 속도 저하 유발)
   2. ident 프로토콜
      * 서버에게 커넥션을 수립한 클라이언트 이름 제공
      * 클라이언트로부터 커넥션 수립 요청 수신시 서버는 클라이언트의 113번 포트와 커넥션을 맺어 클라이언트의 이름 요청
      * 커넥션 수립 지연, 클라이언트 프라이버시 침해, 보안문제등으로 잘 사용되지 않음

### 2. 요청 메시지 수신
* 커넥션으로부터 데이터를 읽어 이해하기 용이한 형태로 파싱
* 요청줄부터 파싱하여 요청 메소드, 리소스 url, 프로토콜 버전 확인
* CRLF로 구분되어있는 메시지 헤더값 파싱
* 바디가 존재한다면 Content-length 파라미터값 참조하여 바디데이터 리딩

### 3. 요청 처리
1.동적 리소스 요청
* 요청 url이 동적컨텐츠에 대한 url일시, 해당 컨텐츠를 담당하는 WAS에 처리 위임

2.정적 리소스 요청 
* 리소스 매핑
	* 요청 메시지의 url을 docroot 경로와 결합하여 리소스의 url 로 파싱
		> docroot
		> * 요청 메시지 url의 root 디렉토리가 되는 경로
		> * 클라이언트에게 서버 디렉토리 구조 노출 방지 목적

* **디렉토리 요청**
   * 요청 url에 특정한 리소스 명시 없이 디렉토리 경로로만 이루어져있는경우
   * default 파일들(index)을 해당경로에서 찾아 응답, 없을경우 파일 목록 응답
      ```
      --- httpd.conf ---
      DirectoryIndex index.html index.htm home.html
      ```

* **가상 호스팅**
   * 하나의 웹서버(Ip주소)에 여러개의 호스트명을 생성하고 각각에게 개별적인 docroot를 할당
   * 각각의 호스트가 하나의 독립적인 웹서버처럼 동작

> cf) 커넥션 요청 처리 아키텍쳐
> 1. 단일 스레드 웹서버
> 	* 단일 스레드만 사용하여 한번에 하나의 커넥션 요청만 처리
> 2. 멀티프로세스/멀티스레드 웹서버
>    * 멀티 프로세스/멀티스레드를 사용하여 동시에 여러개의 요청 처리
>    * 여러개의 프로세스/스레드가 필요하므로 시스템에 부하가 커짐
>    * 공유 리소스 경합문제로 프로세스/스레드 대기 지연 발생
> 3. 다중 I/O 서버
>    * 멀티프로세스/멀티스레드 방식의 공유리소스 경합 대기 지연 문제를 해결
>    * 단일 스레드만으로 여러개의 커넥션 요청 처리 가능
>    * 경합 대기 지연 상태일시, 그동안 다른 커넥션 요청 처리 
>    * 공유 리소스를 사용하지 않는 요청들에 대해서는 큰 성능 향상 효과가 없을듯
> 4. 다중 멀티스레드 웹 서버
>    * 다중 I/O 서버를 멀티 스레드로 구현

### 4. 응답 메시지 생성
* **MIME 타입 결정 방법**
   1. 파일 확장자 : 응답 리소스 파일의 확장자에 해당하는 mime 타입을 mime.types파일을 참조하여 식별
   2. 매직 타이핑 : 응답 리소스 파일의 데이터를 분석하여 패턴을 파악한뒤 해당하는 mime타입을 매직파일을 참조하여 식별
   3. 유형 명시 : 응답 리소스 파일의 유형과 무관하게 특정 mime 타입을 헤더에 설정
   4. 유형 협상 : 응답 리소스 파일에 여러종류의 mime타입을 설정, 클라이언트가 리소스를 표현하기에 가장 좋은 타입으로 선택
* **리다이렉션**
   * 요청 url의 리소스가 다른 위치로 옮겨진 경우 옮겨진 위치의 url을 Location 파라미터로 포함시켜 리다이렉션 응답(응답코드:3xx)
   * 리소스가 옮겨진 경우 외에도, 부하 분산(트래픽이 원활한 서버로 redirect), URL 증강(서버측에서 요청url에 파라미터 포함)시에도 사용

### 5. 응답 메시지 전송

### 6. 로깅
