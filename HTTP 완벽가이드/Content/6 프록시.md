# 웹 프록시 서버
* 클라이언트 - 웹서버 사이에서 중개자 역할
* 클라이언트와의 관계 : 웹 서버처럼 동작
* 웹서버와의 관계 : 클라이언트처럼 동작

<br>

# 프록시 서버 분류
### 사용자에 따라
* **개인 프록시** : 클라이언트 브라우저의 기능 확장등을 목적으로 클라이언트 pc에서 실행되는 프록시 서버
* **공용 프록시** : 웹서버에서 실행되어 웹서버에 접속하는 모든 클라이언트에게 적용되는 프록시 서버
### 프로토콜 호환에 따라
* **프록시** : 클라이언트 - 웹서버 가 같은 프로토콜을 사용하여 통신할 시에만 적용 가능
* **게이트웨이** : 클라이언트 - 웹서버가 서로 다른 프로토콜을 사용하여도 자동으로 메시지를 각 프로토콜에 맞게 전환

<br>

# 프록시 서버 기능
### 클라이언트측 프록시 서버
* **웹사이트 차단** : 특정 웹사이트로부터 오는 응답 차단 e.g.성인웹사이트 접근 차단
* **익명화** : 클라이언트의 요청메시지를 웹 서버로 전송해주기전, 클라이언트 정보가 노출될 수 있는 부분 제거(IP주소, 쿠키 데이터 등)

### 서버측 프록시 서버
* **캐시 서버** : 프록시 서버 로컬에 데이터 캐싱
* **트랜스코딩** : 업스트림서버에서 온 응답메시지를 클라이언트로 보내주기전, 프록시서버에서 내용 편집 가능(압축, 번역 등)
* **권한 검사** : 특정 웹서버, 웹리소스를 요청한 클라이언트의 접근 권한 검사
* **보안 방화벽 서버**

<br>

# 프락시 계층
* 클라이언트와 웹서버사이에는 여러개의 프락시 서버가 계층적으로 위치 가능
### 프락시 계층 구조
* **인바운드 프락시** : 프락시 계층에서 웹서버에 가까운 프락시), 부모 프락시
* **아웃바운드 프락시** : 프락시 계층에서 클라이언트에 가까운 프락시, 자식 프락시
```
Client - Proxy A - Proxy B - Proxy C - proxy D - WebServer
- Proxy B 는 Proxy A 의 부모 프락시(인바운드 프락시)
- Proxy B 는 Proxy C 의 자식 프락시(아웃바운드 프락시)
```

### 프락시 계층 종류
**1. 정적 프락시** : 프락시 계층간에 프락시 순서가 정해져있는 계층
```
Client - Proxy A - Proxy B - Proxy C - proxy D - WebServer
항상 A - B - C - D 의 순서로 프락싱
```
**2. 동적 프락시** : 상황에 따라 프락싱 순서나 프락싱 방향이 변하는 계층
```
Client - Proxy A - Proxy B - Proxy C - proxy D - WebServer
       - Proxy E - Proxy F
                 - Proxy G - Proxy H
       - Proxy I - Proxy J
상황에 따라 Proxy E에서 F 또는 G 로 프록싱
```

### 동적 프락시에서 프락시 방향 선택 방식
1. **부하 균형** : 부하분산을 위해 부모프락시들의 작업량을 비교하여 선택
2. **지리적 인접성** : 원서버의 위치와 거리적으로 가까운곳에 설치되어있는 프록시 서버 선택
3. **URI** : 요청 URI에 대해 사전에 특정 프록시가 할당되어있을경우 해당 프록시 서버 선택
4. **속도 향상** : 빠른 서비스를 위해 캐시 프록시/ 압축 프록시 등으로 선택

<br>

# 클라이언트 요청 인터셉트 방법
1. **클라이언트 설정**
	* 애초에 클라이언트단에서 요청 호스트 주소를 프록시 서버로 설정
	* 클라이언트에서 프락시 서버로 요청 메시지를 전달할시, 요청줄의 uri에 full path(scheme://host:port/uri 작성
		> 프락시 서버는 요청 수신후, 요청줄에 full path 로 작성되어있는 원서버 host에 요청 전달
	```
	클라이언트 > 웹서버
	GET /index.html HTTP/1.0
	
	클라이언트 > 프락시 서버
	GET http://www.test-drive-ems01.ncs.ncl.com/index.html HTTP/1.0
	```
	
2. **네트워크 수정(인터셉트 프락시)**
	* 스위치, 라우터 등의 장치를 이용하여 웹서버로 향하는 클라이언트의 요청을 프록시 서버로 전송
	* 요청메시지의 헤더 정보를 이용해 프록시 서버 > 원 서버로 요청 전송 
	* 호스트 헤더값을 참조하여 원서버 주소 및 포트번호 획득
3. **DNS 수정** : 클라이언트가 참조하는 DNS에 등록되어있는 호스트네임의 IP주소를 프록시 서버 IP주소로 설정
4. **웹서버 수정** : 웹서버가 클라이언트에 305 리다이렉션 응답코드와 함께 프록시서버로의 리다이렉션 주소를 응답

<br>

# URI 자동 확장
* 사용자가 축약한 형태의 호스트 주소를 요청하였을 시, 브라우저에서 자동으로 유효한 호스트 주소로 변환하는 과정
* 일부 브라우저에선 오타가 있는 호스트 주소를 교정하여 사용자가 의도했을 호스트 주소로 변환하는 기능 제공
### 호스트 주소 자동 확장 과정
1. 입력한 호스트 주소에 스킴(http://), 포트번호(80), uri(/) 가 생략되어있다면 추가
2. 스킴과 포트번호, uri를 추가한 호스트 주소로 DNS에 IP 주소 요청
3. DNS로부터 IP주소 탐색 실패 응답 수신 시, 호스트 주소에 접두사 www, 접미사 .com 을 추가하여 재 요청
4. IP 주소 탐색 실패시, 서드파티 사이트로 호스트 주소를 전송하여 오타 교정 시도

### 프락시 서버를 통한 요청시 URI 확장
* 클라이언트가 명시적 프락시와 통신시, 브라우저는 자동 uri 확장을 수행하지 않음
* 따라서 부분 호스트명으로 프락시 서버에 요청시, 서버 IP주소 탐색 실패 에러 발생
* 명시적 프락시가 아닌 프락시(eg. 인터셉트프락시)와의 통신시 브라우저에서 자동 uri 확장 수행