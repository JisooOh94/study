# 클래스 불변식 침해
### 클래스 불변식이 침해되는 대부분의 이유
1. 악의적인 의도를 가지고 클래스 상태를 Invalid 하게 조작
2. 클래스를 사용하는 동료 개발자의 실수

### 클래스 불변식 침해 예시
```java
public class Period {
    private final Date start;
    private final Date end;
    
    public Period(Date start, Date end) {
        if(start.compareTo(end) > 0) {
            throw new IllegalArgumentException();
        } else {
            this.start = start;
            this.end = end;
        }
    }
    
    public Date getStartDate() {
        return start;
    }
    
    public Date getEndDate() {
        return end;
    }
}
```
1. 클라이언트에서 제공하는 가변객체를 클래스 멤버참조변수에 그대로 저장
2. 가변객체를 저장하고있는 멤버참조변수를 그대로 클라이언트에게 제공

### 불변식 침해 해결 방법
1. 방어적 복사를 통해 클라이언트에서 클래스 불변객체의 값을 변경할 수 있는 수단 차단 
2. 객체 참조변수를 불변 변수로 선언
	* e.g Date > Instant/LocalDateTime/ZonedDateTime

# 방어적 복사
* 클래스 가변객체참조변수에 객체 할당시 인자로 전달된 객체(클라이언트에서 참조를 가지고있음)를 복제하여 복제본(클라이언트에서 참조를 가지고있지않음)을 저장
	* 클라이언트에서 인자로 전달한 객체의 값을 수정하여도 클래스에 저장되어있는 객체에는 아무런 영향이 가지 않음
* 클래스 가변객체참조변수 반환시, 참조하고있는 객체를 복제하여 복제본을 반환
	* 클라이언트에서 복제본의 값을 수정하여도 클래스에 저장되어있는 객체에는 아무런 영향이 가지 않음
* 객체 복제시, 객체의 클래스가 확장가능한 클래스인경우, clone()을 통한 복제는 사용하면 안됨
	> 본래의 clone 이 아닌, 자식클래스에서 확장한 clone이 호출될 수 있음
* 클라이언트에서 가변객체의 값을 바꾸지 않을거라는 확신이나, 클라이언트에서 값을 수정해도 기능에 아무런 문제가 없으리라는 정확한 판단이 있는경우가 아니고선, 방어적 복사를 사용하는것이 안전
	> 방어적복사로 인한 성능저하에도 불구하고!!
* 방어적 복사보다 더 좋은 방법은 클래스의 가변객체 참조변수들을 불변변수로 사용하여 방어적 복사 자체가 필요없게 만드는 일 
