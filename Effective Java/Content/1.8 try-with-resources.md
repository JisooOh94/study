# try-finally 구문을 이용한 자원 해제의 문제점
1. 자원해제 코드로 인해 코드가 장황해질뿐만 아니라 중첩 try 구문이 될 경우 코드가 더욱 복잡해진다.
2. try 블록에서 첫번째 예외 발생 후, finally 블록의 자원해제코드에서 두번째 예외가 발생하면 try 블록에서 발생한 첫번째 예외에 대한 정보가 콜스택에 기록되지 않고 사라져버린다.
```java
	public class MyResource implements AutoCloseable {
	    public void doSomething() {
	        System.out.println("Do something");
	        throw new FirstError();
	    }
	
	    @Override
	    public void close() {
	        System.out.println("Close My Resource");
	        throw new SecondError();
	    }
	}
	
	public static void main(String[] args) {
		MyResource myResource = new MyResource();
	    try {
	        myResource.doSomething();
	    } finally {
	        myResource.close();		//FirstError에 대한 정보가 사라짐
	    }
	}
```
```java
	//콜스택
	Exception in thread "main" SecondError
		at MyResource.close(MyResource.java:10)
		at Main.main(Main.java:8)
	
	Process finished with exit code 1
```

# try-with-resource
* java 1.7 에서부터 추가된 기능으로 기존 try-finally 구문의 자원해제 단점보완
* 해제하고자 하는 자원이 AutoCloseable 인터페이스를 구현하고 있어야함(대부분의 써드파티라이브러리들에 구현되어있음)
* 모든 경우에서 try-finally 보다 try-with-resource가 우수하므로 java 7 이상을 사용한다면 무조건 try-with-resource!
### 장점
1. try-resources 에 비해 코드가 간결하고 가독성이 좋다
```java
	public static void main(String[] args) {
		//try-finally 구문
		MyResource myResource = new MyResource();
	    try {
	        myResource.doSomething();
	    } finally {
	        myResource.close();		//FirstError에 대한 정보가 사라짐
	    }
	
		MyResource myResource = new MyResource();
	    try {
	        myResource.doSomething();
	        MyResource myResource2 = null;
	        try {
	           myResource2 = new MyResource();
	           myResource2.doSomething();
	           finally {
	              if(myResource2 != null) {
	                 myResource2.close();
	              }
	           }
	        }
	    } finally {
	        myResource.close();		//FirstError에 대한 정보가 사라짐
	    }
	//========================================================
		//try-with-resource 구문
		try (MyResource myResource = new MyResource()) {
			myResource.doSomething();
		}

		try (MyResource myResource = new MyResource(); MyResource myResource2 = new MyResource()) {
			myResource.doSomething();
			myResource2.doSomething();
		}
	}
```
2. 자원해제시 예외가 발생해도 try 블록에서 발생한 예외가 누락되지 않고 모두 콜스택에 남는다.
> 자원 해제과정에서 발생한 예외도 콜스택에 Suppressed 태그(숨겨졌다는 의미)를 달고 출력됨
```java
	public static void main(String[] args) {
	   try (MyResource myResource = new MyResource()) {
			myResource.doSomething();
		}
	}
```
```java
	//콜스택
	Exception in thread "main" FirstError
		at MyResource.doSomething(MyResource.java:4)
		at Main.main(Main.java:5)
		Suppressed: SecondError
			at MyResource.close(MyResource.java:10)
		at Main.main(Main.java:6)

	Process finished with exit code 1
```